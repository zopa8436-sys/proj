Ô>>ø#include "pch.h"
#include "Utils.h"
#include "MenuItem.h"
#include "Menu.h"
#include "App.h"
#include "Palette.h"


int main()
{
    // –Ω–∞—Å—'—Ä–æ–π–∫–∞ –≤—<–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–>>—å
    init(L"–ó–∞–¥–∞–Ω–∏–µ –Ω–∞ 04.02.2026 - –ø—Ä–∞–∫—'–∏–∫–∞ –∏—Å–ø–æ–>>—å–∑–æ–≤–∞–Ω–∏—è STL –≤ —Ä–∞–∑—Ä–∞–+/-–æ—'–∫–µ –ø—Ä–∏–>>–æ–∂–µ–Ω–∏–π");
    ostringstream oss;

    // –∫–æ–¥—< –∫–æ–º–∞–Ω–¥
    enum Commands : int {
        // –ü–æ–∫–∞–∞–∑–∞—'—å —'–µ–∫—É—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–µ
        CMD_SHOW_ALL = 1001,

        // – –æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–>>–>>–µ–∫—-–∏–∏ —Ñ–∞–+/-—Ä–∏—á–Ω—<–º –º–µ—'–æ–¥–æ–º
        CMD_CREATE_FACTORY,

        // –î–æ–+/-–∞–≤–>>–µ–Ω–∏–µ –∏–≥—Ä—<, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–∞–+/-—Ä–∏—á–Ω—<–º –º–µ—'–æ–¥–æ–º
        CMD_ADD,

        // –†–µ–¥–∞–∫—'–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä—< (—Ñ–∞–+/-—Ä–∏—á–Ω—<–º –º–µ—'–æ–¥–æ–º, –∏–¥ –≤–≤–æ–¥–∏—'—Å—è —Å –∫–>>–∞–≤–∏–∞—'—É—Ä—<)
        CMD_EDIT_BY_ID,

        // –£–¥–∞–>>–µ–Ω–∏–µ –∏–≥—Ä—< –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É
        CMD_DELETE_BY_ID,

        // –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –∏–≥—Ä –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É
        CMD_ORDER_BY_ID,

        // –£–ø–æ—Ä—è–¥–æ—á–∏—'–µ –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è
        CMD_ORDER_BY_YEAR_DESC,

        // –£–ø–æ—Ä—è–¥–æ—á–∏—'–µ –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ –≤–æ–∑—Ä–∞—Å—'–∞–Ω–∏—é —-–µ–Ω—<
        CMD_ORDER_BY_PRICE_ASC,

        // –£–ø–æ—Ä—è–¥–æ—á–∏—'–µ –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –∫–æ–>>–∏—á–µ—Å—'–≤–∞ –ø—Ä–æ–¥–∞–Ω–Ω—<—Ö –∫–æ–ø–∏–π
        CMD_ORDER_BY_SOLD_DESC,

        // –'—<–+/-–æ—Ä–∫–∞ –∏–≥—Ä –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É —-–µ–Ω—<, —Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—'–∞–Ω–∏—é —-–µ–Ω—<
        CMD_SELECT_BY_PRICE_RANGE,

        // –'—<–+/-–æ—Ä–∫–∞ –∏–≥—Ä –ø–æ –≥–æ–¥—É –∏–∑–¥–∞–Ω–∏—è, —Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ –∂–∞–Ω—Ä—É
        CMD_SELECT_BY_YEAR,

        // –'—<–+/-–æ—Ä–∫–∞ –∏–≥—Ä –ø–æ –û–°, —Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è
        CMD_SELECT_BY_OS,

        // –ó–∞–ø–∏—Å—å —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–∞–≥–∞–∑–∏–Ω–µ –∏ –∫–æ–>>–>>–µ–∫—-–∏–∏ –∏–≥—Ä –≤ CSV-—Ñ–∞–π–>>
        CMD_SAVE_CSV,

        // –ß—'–µ–Ω–∏–µ —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–∞–≥–∞–∑–∏–Ω–µ –∏ –∫–æ–>>–>>–µ–∫—-–∏–∏ –∏–≥—Ä –∏–∑ CSV-—Ñ–∞–π–>>–∞
        CMD_LOAD_CSV,
    };

    // –≤–µ–∫—'–æ—Ä –ø—É–Ω–∫—'–æ–≤ –º–µ–Ω—é
    vector<MenuItem> items = {
        {CMD_SHOW_ALL,              "–ü–æ–∫–∞–∞–∑–∞—'—å —'–µ–∫—É—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–µ"},
        {CMD_CREATE_FACTORY,        "– –æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–>>–>>–µ–∫—-–∏–∏ (—Ñ–∞–+/-—Ä–∏—á–Ω—<–π –º–µ—'–æ–¥)"},
        {CMD_ADD,                   "–î–æ–+/-–∞–≤–>>–µ–Ω–∏–µ –∏–≥—Ä—< (—Ñ–∞–+/-—Ä–∏—á–Ω—<–π –º–µ—'–æ–¥)"},
        {CMD_EDIT_BY_ID,            "–†–µ–¥–∞–∫—'–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä—< –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É (—Ñ–∞–+/-—Ä–∏—á–Ω—<–π –º–µ—'–æ–¥)"},
        {CMD_DELETE_BY_ID,          "–£–¥–∞–>>–µ–Ω–∏–µ –∏–≥—Ä—< –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É"},
        {CMD_ORDER_BY_ID,           "–£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –∏–≥—Ä –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É"},
        {CMD_ORDER_BY_YEAR_DESC,    "–£–ø–æ—Ä—è–¥–æ—á–∏—'—å –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è"},
        {CMD_ORDER_BY_PRICE_ASC,    "–£–ø–æ—Ä—è–¥–æ—á–∏—'—å –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ –≤–æ–∑—Ä–∞—Å—'–∞–Ω–∏—é —-–µ–Ω—<"},
        {CMD_ORDER_BY_SOLD_DESC,    "–£–ø–æ—Ä—è–¥–æ—á–∏—'—å –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –ø—Ä–æ–¥–∞–Ω–Ω—<—Ö –∫–æ–ø–∏–π"},
        {CMD_SELECT_BY_PRICE_RANGE, "–'—<–+/-–æ—Ä–∫–∞ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É —-–µ–Ω (—Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—'–∞–Ω–∏—é —-–µ–Ω—<)"},
        {CMD_SELECT_BY_YEAR,        "–'—<–+/-–æ—Ä–∫–∞ –ø–æ –≥–æ–¥—É –∏–∑–¥–∞–Ω–∏—è (—Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ –∂–∞–Ω—Ä—É)"},
        {CMD_SELECT_BY_OS,          "–'—<–+/-–æ—Ä–∫–∞ –ø–æ –û–° (—Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è)"},
        {CMD_SAVE_CSV,              "–ó–∞–ø–∏—Å—å —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–∞–≥–∞–∑–∏–Ω–µ –≤ —Ñ–∞–π–>> CSV"},
        {CMD_LOAD_CSV,              "–ß—'–µ–Ω–∏–µ —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–∞–≥–∞–∑–∏–Ω–µ –∏–∑ —Ñ–∞–π–>>–∞ CSV"},
        {Menu::CMD_QUIT,            "–'—<—Ö–æ–¥ –∏–∑ –ø—Ä–∏–>>–æ–∂–µ–Ω–∏—è"}
    };

    Menu mainMenu(COORD{ 5, 5 }, items, infoColor, hintColor);

    // –û–+/-—ä–µ–∫—' –∫–>>–∞—Å—Å–∞ –ø—Ä–∏–>>–æ–∂–µ–Ω–∏—è –¥–>>—è –æ–+/-—Ä–∞–+/-–æ—'–æ–∫ –ø–æ –∑–∞–¥–∞–Ω–∏—é
    App* app = nullptr;

    while (true) {
        try {
            // –°–æ–∑–¥–∞–Ω–∏–µ –æ–+/-—ä–µ–∫—'–∞ –ø—Ä–∏–>>–æ–∂–µ–Ω–∏—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –æ–+/-–>>–∞—Å—'–∏
            if (app == nullptr) {
                app = new App();
            } // if

            cout << color(mainColor) << cls;
            showNavBarMessage(
                hintColor, acctColor,
                "  –ú–∞–≥–∞–∑–∏–Ω –∫–æ–º–ø—å—é—'–µ—Ä–Ω—<—Ö –∏–≥—Ä (STL, –∞–>>–≥–æ—Ä–∏—'–º—<)  |  ~Esc~ ~F10~ –'—<—Ö–æ–¥"
            );
            int cmd = mainMenu.navigate();
            cout << color(mainColor) << cls;
            if (cmd == Menu::CMD_QUIT) break;

            switch (cmd) {
                // –ü–æ–∫–∞–∞–∑–∞—'—å —'–µ–∫—É—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–µ
            case CMD_SHOW_ALL:
                app->doShowAll();
                break;

                // – –æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–>>–>>–µ–∫—-–∏–∏ —Ñ–∞–+/-—Ä–∏—á–Ω—<–º –º–µ—'–æ–¥–æ–º
            case CMD_CREATE_FACTORY:
                app->doCreateFactoryCollection();
                break;

                // –î–æ–+/-–∞–≤–>>–µ–Ω–∏–µ –∏–≥—Ä—<, —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–∞–+/-—Ä–∏—á–Ω—<–º –º–µ—'–æ–¥–æ–º
            case CMD_ADD:
                app->doAddGame();
                break;

                // –†–µ–¥–∞–∫—'–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–≥—Ä—< (—Ñ–∞–+/-—Ä–∏—á–Ω—<–º –º–µ—'–æ–¥–æ–º, –∏–¥ –≤–≤–æ–¥–∏—'—Å—è —Å –∫–>>–∞–≤–∏–∞—'—É—Ä—<)
            case CMD_EDIT_BY_ID:
                app->doEditGameById();
                break;

                // –£–¥–∞–>>–µ–Ω–∏–µ –∏–≥—Ä—< –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É
            case CMD_DELETE_BY_ID:
                app->doDeleteGameById();
                break;

                // –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –∏–≥—Ä –ø–æ –∏–¥–µ–Ω—'–∏—Ñ–∏–∫–∞—'–æ—Ä—É
            case CMD_ORDER_BY_ID:
                app->doOrderById();
                break;

                // –£–ø–æ—Ä—è–¥–æ—á–∏—'–µ –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è
            case CMD_ORDER_BY_YEAR_DESC:
                app->doOrderByYearDescending();
                break;

                // –£–ø–æ—Ä—è–¥–æ—á–∏—'–µ –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ –≤–æ–∑—Ä–∞—Å—'–∞–Ω–∏—é —-–µ–Ω—<
            case CMD_ORDER_BY_PRICE_ASC:
                app->doOrderByPriceAscending();
                break;

                // –£–ø–æ—Ä—è–¥–æ—á–∏—'–µ –≤—<–≤–æ–¥ –∏–≥—Ä –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –∫–æ–>>–∏—á–µ—Å—'–≤–∞ –ø—Ä–æ–¥–∞–Ω–Ω—<—Ö –∫–æ–ø–∏–π
            case CMD_ORDER_BY_SOLD_DESC:
                app->doOrderBySoldCopiesDescending();
                break;

                // –'—<–+/-–æ—Ä–∫–∞ –∏–≥—Ä –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É —-–µ–Ω—<, —Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—'–∞–Ω–∏—é —-–µ–Ω—<
            case CMD_SELECT_BY_PRICE_RANGE:
                app->doFindByPriceRange();
                break;

                // –'—<–+/-–æ—Ä–∫–∞ –∏–≥—Ä –ø–æ –≥–æ–¥—É –∏–∑–¥–∞–Ω–∏—è, —Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ –∂–∞–Ω—Ä—É
            case CMD_SELECT_BY_YEAR:
                app->doFindByPubYear();
                break;

                // –'—<–+/-–æ—Ä–∫–∞ –∏–≥—Ä –ø–æ –û–°, —Å–æ—Ä—'–∏—Ä–æ–≤–∫–∞ –ø–æ —É–+/-—<–≤–∞–Ω–∏—é –≥–æ–¥–∞ –∏–∑–¥–∞–Ω–∏—è
            case CMD_SELECT_BY_OS:
                app->doFindByOS();
                break;

                // –ó–∞–ø–∏—Å—å —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–∞–≥–∞–∑–∏–Ω–µ –∏ –∫–æ–>>–>>–µ–∫—-–∏–∏ –∏–≥—Ä –≤ CSV-—Ñ–∞–π–>>
            case CMD_SAVE_CSV:
                app->doSaveToCsv();
                break;

                // –ß—'–µ–Ω–∏–µ —Å–≤–µ–¥–µ–Ω–∏–π –æ –º–∞–≥–∞–∑–∏–Ω–µ –∏ –∫–æ–>>–>>–µ–∫—-–∏–∏ –∏–≥—Ä –∏–∑ CSV-—Ñ–∞–π–>>–∞
            case CMD_LOAD_CSV:
                app->doLoadFromCsv();
                break;
            } // switch
        }
        catch (exception& ex) {
            // –∑–∞–>>–∏–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞ –+/-–∞–∑–æ–≤—<–º —-–≤–µ—'–æ–º, –≤—<–≤–æ–¥ —Å—'—Ä–æ–∫–∏ –Ω–∞–≤–∏–≥–∞—-–∏–∏ —Å —Å–æ–æ–+/-—â–µ–Ω–∏–µ–º
            cout << color(mainColor) << cls;
            showNavBarMessage(hintColor, "  –û—à–∏–+/-–∫–∞ –≤ –ø—Ä–∏–>>–æ–∂–µ–Ω–∏–∏, –Ω–∞–∂–º–∏—'–µ –>>—é–+/-—É—é –∫–>>–∞–≤–∏—à—É –¥–>>—è –ø—Ä–æ–¥–æ–>>–∂–µ–Ω–∏—è");

            int width = 72;

            oss.str("");
            oss << endlm(4) << left
                << "\t" << setw(width) << " " << "\n"
                << "\t" << setw(width) << "    [–û—à–∏–+/-–∫–∞]" << "\n"
                << "\t    " << left << setw(width - 4) << ex.what() << right << "\n"
                << "\t" << setw(width) << " " << "\n"
                << "\t" << setw(width) << " " << "\n"
                << endlm(4)
                << right;
            showMessage(oss.str(), errColor, mainColor);
        } // try-catch

        getKey("    –ù–∞–∂–º–∏—'–µ –>>—é–+/-—É—é –∫–>>–∞–≤–∏—à—É –¥–>>—è –ø—Ä–æ–¥–æ–>>–∂–µ–Ω–∏—è...");
    } // while

    delete app;
    cls();
    return 0;
} // main
